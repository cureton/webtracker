<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AlphaSpid Satellite Tracker</title>
  <script src="https://unpkg.com/satellite.js/dist/satellite.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; }
    canvas { max-width: 500px; max-height: 500px; }
    #map, #footprintMap { height: 400px; width: 100%; margin-top: 10px; }
    #log { white-space: pre-wrap; height: 150px; overflow-y: scroll; background: #eee; padding: 0.5em; }
    .aos-icon, .los-icon {
      font-weight: bold;
      font-size: 14px;
      color: white;
      padding: 2px 6px;
      border-radius: 4px;
      box-shadow: 0 0 4px rgba(0,0,0,0.5);
      pointer-events: none;
      user-select: none;
    }
    .aos-icon { background-color: green; }
    .los-icon { background-color: red; }
    .map-container {
      display: table;
      width: 100%;
    }
    .map-cell {
      display: table-cell;
      width: 50%;
      vertical-align: top;
      padding-right: 10px;
    }
  </style>
</head>
<body>
  <h1>AlphaSpid Satellite Tracker</h1>

  <h2>Enter TLE</h2>
  <textarea id="tle" rows="3" cols="80">1 25544U 98067A   24140.59773148  .00005450  00000+0  10384-3 0  9994
2 25544  51.6417  45.6747 0003224  64.3883 295.7571 15.50685758445177</textarea><br>
  <label>Orbits to predict: <input type="number" id="orbitCount" min="1" max="5" value="1" /></label><br>
  <button id="connect">Connect to Rotator</button>
  <button id="start">Start Tracking</button>

  <h2>Observer Location</h2>
  <div>
    <label>Latitude: <input type="number" step="any" id="latInput"></label>
    <label>Longitude: <input type="number" step="any" id="lonInput"></label>
    <button id="setLocation">Set Location</button>
  </div>

  <h2>Status Log</h2>
  <pre id="log"></pre>

  <h2>Az/El Plot</h2>
  <canvas id="azelChart"></canvas>

  <h2>Maps</h2>
  <div class="map-container">
    <div class="map-cell">
      <h3>Ground Track</h3>
      <div id="map"></div>
    </div>
    <div class="map-cell">
      <h3>Satellite Footprint</h3>
      <div id="footprintMap"></div>
    </div>
  </div>

  <script>
    let port, writer, satrec, intervalId, chart, map, footprintMap;
    let satMarker, trailLine, observerMarker, footprintCircle, subpointMarker;
    let aosMarker, losMarker, predictionLine, footprintTrailLine;
    let lastElevation = null;
    const trailCoords = [];
    const footprintTrailCoords = [];

    // ... [rest of JS code remains unchanged until trail update section]

    // Add to your setInterval() inside the tracking update function:
const lat = satellite.degreesLat(geo.latitude);
const lon = satellite.degreesLong(geo.longitude);

trailCoords.push([lat, lon]);
if (trailCoords.length > 200) trailCoords.shift();
if (trailLine) map.removeLayer(trailLine);
trailLine = L.polyline(trailCoords, { color: 'blue' }).addTo(map);

footprintTrailCoords.push([lat, lon]);
if (footprintTrailCoords.length > 200) footprintTrailCoords.shift();
if (footprintTrailLine) footprintMap.removeLayer(footprintTrailLine);
footprintTrailLine = L.polyline(footprintTrailCoords, { color: 'blue' }).addTo(footprintMap);

// ... [rest of JS code continues unchanged]
  </script>
</body>
</html>
